{
	"name": "LOG_AND_ERROR_HANDLING_SQLDB",
	"properties": {
		"activities": [
			{
				"name": "LogStart",
				"type": "IfCondition",
				"dependsOn": [],
				"userProperties": [],
				"typeProperties": {
					"expression": {
						"value": "@equals(pipeline().parameters.logType,'START')",
						"type": "Expression"
					},
					"ifTrueActivities": [
						{
							"name": "Log the start of the job",
							"description": "Calls the stored procedure which logs the start of the pipeline",
							"type": "SqlServerStoredProcedure",
							"dependsOn": [],
							"policy": {
								"timeout": "0.00:10:00",
								"retry": 1,
								"retryIntervalInSeconds": 30,
								"secureOutput": false,
								"secureInput": false
							},
							"userProperties": [],
							"typeProperties": {
								"storedProcedureName": {
									"value": "@pipeline().parameters.sp_LogInsert",
									"type": "Expression"
								},
								"storedProcedureParameters": {
									"hostMachine": {
										"value": {
											"value": "@pipeline().parameters.hostMachine",
											"type": "Expression"
										},
										"type": "String"
									},
									"jobLibraryKey": {
										"value": {
											"value": "@pipeline().parameters.jobLibraryKey",
											"type": "Expression"
										},
										"type": "String"
									},
									"jobLoggingKey": {
										"value": {
											"value": "@pipeline().parameters.jobLoggingKey",
											"type": "Expression"
										},
										"type": "String"
									},
									"ownerName": {
										"value": {
											"value": "@pipeline().parameters.ownerName",
											"type": "Expression"
										},
										"type": "String"
									}
								}
							},
							"linkedServiceName": {
								"referenceName": "USCDO_SQLDB",
								"type": "LinkedServiceReference"
							}
						}
					]
				}
			},
			{
				"name": "LogUpdate",
				"type": "IfCondition",
				"dependsOn": [],
				"userProperties": [],
				"typeProperties": {
					"expression": {
						"value": "@equals(pipeline().parameters.logType,'END')",
						"type": "Expression"
					},
					"ifTrueActivities": [
						{
							"name": "Log the end of the job",
							"description": "Calls the stored procedure which logs the end of the pipeline",
							"type": "SqlServerStoredProcedure",
							"dependsOn": [],
							"policy": {
								"timeout": "0.00:10:00",
								"retry": 1,
								"retryIntervalInSeconds": 30,
								"secureOutput": false,
								"secureInput": false
							},
							"userProperties": [],
							"typeProperties": {
								"storedProcedureName": {
									"value": "@pipeline().parameters.sp_LogUpdate",
									"type": "Expression"
								},
								"storedProcedureParameters": {
									"jobLibraryKey": {
										"value": {
											"value": "@pipeline().parameters.jobLibraryKey",
											"type": "Expression"
										},
										"type": "String"
									},
									"jobLoggingKey": {
										"value": {
											"value": "@pipeline().parameters.jobLoggingKey",
											"type": "Expression"
										},
										"type": "String"
									},
									"rowsDeleted": {
										"value": {
											"value": "@pipeline().parameters.rowsDeleted",
											"type": "Expression"
										},
										"type": "Int32"
									},
									"rowsInserted": {
										"value": {
											"value": "@pipeline().parameters.rowsInserted",
											"type": "Expression"
										},
										"type": "Int32"
									},
									"rowsProcessed": {
										"value": {
											"value": "@pipeline().parameters.rowsProcessed",
											"type": "Expression"
										},
										"type": "Int32"
									},
									"rowsUpdated": {
										"value": {
											"value": "@pipeline().parameters.rowsUpdated",
											"type": "Expression"
										},
										"type": "Int32"
									}
								}
							},
							"linkedServiceName": {
								"referenceName": "USCDO_SQLDB",
								"type": "LinkedServiceReference"
							}
						}
					]
				}
			},
			{
				"name": "LogError",
				"type": "IfCondition",
				"dependsOn": [],
				"userProperties": [],
				"typeProperties": {
					"expression": {
						"value": "@equals(pipeline().parameters.logType,'ERROR')",
						"type": "Expression"
					},
					"ifTrueActivities": [
						{
							"name": "Log a job error",
							"description": "Calls the stored procedure which logs the failure of a job",
							"type": "SqlServerStoredProcedure",
							"dependsOn": [],
							"policy": {
								"timeout": "0.00:10:00",
								"retry": 1,
								"retryIntervalInSeconds": 30,
								"secureOutput": false,
								"secureInput": false
							},
							"userProperties": [],
							"typeProperties": {
								"storedProcedureName": {
									"value": "@pipeline().parameters.sp_LogError",
									"type": "Expression"
								},
								"storedProcedureParameters": {
									"errorMessage": {
										"value": {
											"value": "@pipeline().parameters.logMessage",
											"type": "Expression"
										},
										"type": "String"
									},
									"errorNumber": {
										"value": "-1",
										"type": "Int32"
									},
									"errorProcedure": {
										"value": {
											"value": "@pipeline().parameters.ownerName",
											"type": "Expression"
										},
										"type": "String"
									},
									"errorSeverity": {
										"value": "-1",
										"type": "Int32"
									},
									"errorState": {
										"value": "-1",
										"type": "Int32"
									},
									"jobLibraryKey": {
										"value": {
											"value": "@pipeline().parameters.jobLibraryKey",
											"type": "Expression"
										},
										"type": "String"
									},
									"jobLoggingKey": {
										"value": {
											"value": "@pipeline().parameters.jobLoggingKey",
											"type": "Expression"
										},
										"type": "String"
									}
								}
							},
							"linkedServiceName": {
								"referenceName": "USCDO_SQLDB",
								"type": "LinkedServiceReference"
							}
						}
					]
				}
			}
		],
		"parameters": {
			"logType": {
				"type": "string",
				"defaultValue": "START"
			},
			"sp_LogInsert": {
				"type": "string",
				"defaultValue": "[logging].[p_ins_jobLogging]"
			},
			"sp_LogUpdate": {
				"type": "string",
				"defaultValue": "[logging].[p_upd_jobLogging]"
			},
			"sp_LogError": {
				"type": "string",
				"defaultValue": "[logging].[p_ins_jobError]"
			},
			"hostMachine": {
				"type": "string",
				"defaultValue": "GX-ZEUDF-INTERNAL-ADF-T001"
			},
			"jobLibraryKey": {
				"type": "string",
				"defaultValue": "28978541-DCA3-4F00-A6CC-87CC67A782ED"
			},
			"jobLoggingKey": {
				"type": "string",
				"defaultValue": "AE79BB97-2D35-4FA4-B426-1E34B433F2E4"
			},
			"mode": {
				"type": "string",
				"defaultValue": "'ADF'"
			},
			"ownerName": {
				"type": "string",
				"defaultValue": "LOG_AND_ERROR_HANDLING"
			},
			"logMessage": {
				"type": "string",
				"defaultValue": "No Log Message Sent From Parent"
			},
			"rowsInserted": {
				"type": "string",
				"defaultValue": "0"
			},
			"rowsProcessed": {
				"type": "string",
				"defaultValue": "0"
			},
			"rowsUpdated": {
				"type": "string",
				"defaultValue": "0"
			},
			"rowsDeleted": {
				"type": "string",
				"defaultValue": "0"
			}
		},
		"variables": {
			"strSTART": {
				"type": "String",
				"defaultValue": "'START'"
			},
			"strEND": {
				"type": "String",
				"defaultValue": "'END'"
			},
			"strERROR": {
				"type": "String",
				"defaultValue": "'ERROR'"
			}
		},
		"folder": {
			"name": "Common"
		},
		"annotations": [],
		"lastPublishTime": "2021-08-16T11:02:56Z"
	},
	"type": "Microsoft.DataFactory/factories/pipelines"
}